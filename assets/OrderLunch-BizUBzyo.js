import{m as Q,r,j as e,C as z,B as f}from"./index-ToK4oclC.js";import"./index-DE--nJQ8.js";import{f as A,n as N}from"./DefaultLayout-Bd4H0nrj.js";import{a as x}from"./index.es-B4jYxs2R.js";import{u as y}from"./userService-CK-_Ge7J.js";import{C,a as O}from"./CCardBody-CkzAK4Az.js";import{C as G}from"./CCardHeader-DZ7yCZfJ.js";import{C as q,a as v,b as j,c as a,d as F,e as d}from"./CTable-CodFXNb6.js";import{C as L}from"./CAlert-CCUK6Gbz.js";import{C as X}from"./CFormInput-CFmmYjHG.js";import"./cil-lock-locked-DmxpJbVL.js";import"./CFormControlWrapper-BlqY_IUc.js";import"./CFormControlValidation-C-saBsBy.js";import"./CFormLabel-BtPAOGaG.js";const he=()=>{const u=Q(s=>s.userLogged),[l,h]=r.useState([]),[J,M]=r.useState([]),[p,_]=r.useState(null),[b,g]=r.useState(0),[D,R]=r.useState([]);r.useState(0);const[w,T]=r.useState(!0);r.useState(!1);const[k,m]=r.useState(!0),[E,B]=r.useState("");r.useEffect(()=>{Y(),V()},[]);const V=()=>{try{const s=A(new Date);B(s)}catch{}};r.useEffect(()=>{const s=l.filter(t=>t.quantity>0);if(s.length>0){let t=0;s.map(n=>{t+=n.quantity*n.price}),g(t*1e3)}else g(0);M(s)},[l]);const Y=async()=>{try{const s=await y.getAllDataLunch();if(s.length>0){const t=s[s.length-1],n=new Date(t.date),i=new Date;n.getDate()==i.getDate()&&n.getMonth()==i.getMonth()&&n.getFullYear()==i.getFullYear()?(_(t),S(t),t.foods.map(o=>o.quantity=0),h(t.foods)):m(!1)}}catch(s){console.log(s),m(!1),setIsRefreshing(!1)}},S=async s=>{try{const t=await y.UMCL_getLunchDetail(s._id);if(m(!1),t){let n=[];t.foods.map(o=>{o.orders.map(c=>{c.empCode==u.emp_code&&n.push(c)})}),R(n),T(!(n.length>0));let i=0;n.map(o=>{i+=o.quantity*o.price}),g(i*1e3)}}catch(t){m(!1),console.log(t)}},H=(s,t)=>{const n=[...l];n[s].quantity=parseInt(t.target.value,10),h(n)},I=s=>{const t=[...l];t[s].quantity=Math.max(t[s].quantity-1,0),h(t)},P=s=>{const t=[...l];t[s].quantity=t[s].quantity+1,h(t)},W=async()=>{try{if(l.find(t=>t.quantity>0)){const t=l.filter(c=>c.quantity>0);let n=[];t.map(c=>{n.push({id:c.id,empCode:u.emp_code,userName:u.full_name,quantity:c.quantity,foodName:c.name,price:c.price})});const i={listFoods:n};await y.UMCL_placeOrder(p._id,i)&&(f.success("Đặt món thành công!"),m(!0),S(p))}else f.warning("Vui lòng chọn ít nhất 1 món!")}catch{}},U=async()=>{try{if(await y.UMCL_cancelOrder(p._id,u.emp_code)){f.success("Hủy đặt món thành công!");let t=[...l];t.map(n=>n.quantity=0),h(t)}if(!w){T(!0);return}}catch(s){console.log(s)}};return e.jsx(e.Fragment,{children:k?e.jsx(z,{color:"primary",style:{marginLeft:15,marginTop:15}}):e.jsxs(C,{className:"mb-4",children:[e.jsxs(G,{style:{display:"flex",justifyContent:"space-between"},children:[e.jsxs("div",{children:[e.jsx("strong",{children:"RDT Lunch"})," ",e.jsx("small",{children:"Đặt món ăn"})]}),e.jsx("div",{children:e.jsx("strong",{children:E})})]}),D.length>0&&!w?e.jsxs(O,{children:[e.jsx("p",{className:"text-body-secondary small",children:"Chọn món và sau đó xác nhận."}),e.jsxs(q,{children:[e.jsx(v,{children:e.jsxs(j,{children:[e.jsx(a,{scope:"col",children:"#"}),e.jsx(a,{scope:"col",children:"Tên món"}),e.jsx(a,{scope:"col",children:"Giá"}),e.jsx(a,{scope:"col",className:"mb-2",children:"Số lượng"})]})}),e.jsx(F,{children:D.map((s,t)=>e.jsxs(j,{children:[e.jsx(a,{scope:"row",children:t+1}),e.jsx(d,{children:s.foodName}),e.jsxs(d,{children:[s.price,".000 VNĐ"]}),e.jsx(d,{children:s.quantity})]},s.id))})]}),e.jsx("div",{style:{marginVertical:10,height:5,borderRadius:10,backgroundColor:"#F3F4F7"}}),e.jsx(L,{style:{marginTop:10},color:"success",children:"Bạn đã đặt thành công!"}),e.jsxs(C,{className:"mb-4",style:{marginTop:10,padding:15,display:"flex",flexDirection:"row",justifyContent:"space-between"},children:[e.jsxs("div",{style:{display:"flex",flexDirection:"column"},children:[e.jsxs("span",{style:{fontSize:28,fontWeight:"bold",color:"#1B9E3E"},children:[N(b)," VNĐ"]}),e.jsx("span",{style:{},children:"Tổng tiền"})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column"},children:e.jsx(x,{onClick:()=>U(),type:"submit",color:"secondary",children:"HỦY ĐẶT"})})]})]}):e.jsxs(O,{children:[e.jsx("p",{className:"text-body-secondary small",children:"Chọn món và sau đó xác nhận."}),e.jsxs(q,{children:[e.jsx(v,{children:e.jsxs(j,{children:[e.jsx(a,{scope:"col",children:"#"}),e.jsx(a,{scope:"col",children:"Tên món"}),e.jsx(a,{scope:"col",children:"Giá"}),e.jsx(a,{scope:"col",className:"mb-2",children:"Số lượng"})]})}),e.jsx(F,{children:l.map((s,t)=>e.jsxs(j,{children:[e.jsx(a,{scope:"row",children:t+1}),e.jsx(d,{children:s.name}),e.jsxs(d,{children:[s.price,".000 VNĐ"]}),e.jsx(d,{className:"mb-2",children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx(x,{color:"secondary",onClick:()=>I(t),children:"-"}),e.jsx(X,{type:"number",value:s.quantity,onChange:n=>H(t,n),style:{maxWidth:150,minWidth:50,marginLeft:10,marginRight:10},min:0,max:10}),e.jsx(x,{color:"secondary",onClick:()=>P(t),children:"+"})]})})]},s.id))})]}),e.jsx("div",{style:{marginVertical:10,height:5,borderRadius:10,backgroundColor:"#F3F4F7"}}),p?e.jsxs(C,{className:"mb-4",style:{marginTop:10,padding:15,display:"flex",flexDirection:"row",justifyContent:"space-between"},children:[e.jsxs("div",{style:{display:"flex",flexDirection:"column"},children:[e.jsxs("span",{style:{fontSize:28,fontWeight:"bold",color:"#1B9E3E"},children:[N(b)," VNĐ"]}),e.jsx("span",{style:{},children:"Tổng tiền"})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column"},children:e.jsx(x,{onClick:()=>W(),type:"submit",color:"primary",children:"Xác nhận"})})]}):e.jsxs(L,{color:"warning",dismissible:!1,style:{marginTop:10},onClose:()=>{},children:[e.jsx("strong",{children:"Chưa lên món!"})," nhắn cho Thành ngay để lên món nhé."]})]})]})})};export{he as default};
