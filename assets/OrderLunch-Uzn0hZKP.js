import{n as H,r,j as e,B as g}from"./index-lgGVxdIU.js";import"./index-Dd_mgrYK.js";import"./DefaultLayout-BVuHXmq9.js";import{a as u}from"./index.es-CceUG9kC.js";import{u as p}from"./userService-CvTn7Z71.js";import{C as f,a as O}from"./CCardBody-CKbZvl63.js";import{C as I}from"./CCardHeader-Gnkw6Dil.js";import{C as q,a as v,b as x,c as a,d as F,e as h}from"./CTable-YniI7oTd.js";import{C as P}from"./CAlert-KMQKWidP.js";import{C as W}from"./CFormInput-Dl42fs9s.js";import"./cil-lock-locked-DmxpJbVL.js";import"./CFormControlWrapper-C1qlx8yf.js";import"./CFormControlValidation-_b8dGaSx.js";import"./CFormLabel-Bx3wOF4f.js";const S=d=>d.toString().replace(/\B(?=(\d{3})+(?!\d))/g,"."),re=()=>{const d=H(t=>t.userLogged),[c,m]=r.useState([]),[U,T]=r.useState([]),[y,L]=r.useState(null),[C,j]=r.useState(0),[b,_]=r.useState([]);r.useState(0);const[D,w]=r.useState(!0);r.useState(!1),r.useEffect(()=>{R()},[]),r.useEffect(()=>{const t=c.filter(s=>s.quantity>0);if(t.length>0){let s=0;t.map(n=>{s+=n.quantity*n.price}),j(s*1e3)}else j(0);T(t)},[c]);const R=async()=>{try{const t=await p.getAllDataLunch();if(t.length>0){const s=t[t.length-1],n=new Date(s.date),i=new Date;n.getDate()==i.getDate()&&n.getMonth()==i.getMonth()&&n.getFullYear()==i.getFullYear()&&(L(s),N(s),s.foods.map(o=>o.quantity=0),m(s.foods))}}catch(t){console.log(t),setLoading(!1),setIsRefreshing(!1)}},N=async t=>{try{const s=await p.UMCL_getLunchDetail(t._id);if(s){let n=[];s.foods.map(o=>{o.orders.map(l=>{l.empCode==d.emp_code&&n.push(l)})}),_(n),w(!(n.length>0));let i=0;n.map(o=>{i+=o.quantity*o.price}),j(i*1e3)}}catch(s){console.log(s)}},k=(t,s)=>{const n=[...c];n[t].quantity=parseInt(s.target.value,10),m(n)},B=t=>{const s=[...c];s[t].quantity=Math.max(s[t].quantity-1,0),m(s)},E=t=>{const s=[...c];s[t].quantity=s[t].quantity+1,m(s)},M=async()=>{try{if(c.find(s=>s.quantity>0)){const s=c.filter(l=>l.quantity>0);let n=[];s.map(l=>{n.push({id:l.id,empCode:d.emp_code,userName:d.full_name,quantity:l.quantity,foodName:l.name,price:l.price})});const i={listFoods:n};await p.UMCL_placeOrder(y._id,i)&&(g.success("Đặt món thành công!"),N(y))}else g.warning("Vui lòng chọn ít nhất 1 món!")}catch{}},V=async()=>{try{if(await p.UMCL_cancelOrder(y._id,d.emp_code)){g.success("Hủy đặt món thành công!");let s=[...c];s.map(n=>n.quantity=0),m(s)}if(!D){w(!0);return}}catch{}};return e.jsx(e.Fragment,{children:e.jsxs(f,{className:"mb-4",children:[e.jsxs(I,{style:{display:"flex",justifyContent:"space-between"},children:[e.jsxs("div",{children:[e.jsx("strong",{children:"RDT Lunch"})," ",e.jsx("small",{children:"Đặt món ăn"})]}),e.jsx("div",{children:e.jsx("strong",{children:"30/10/2024"})})]}),b.length>0&&!D?e.jsxs(O,{children:[e.jsx("p",{className:"text-body-secondary small",children:"Chọn món và sau đó xác nhận."}),e.jsxs(q,{children:[e.jsx(v,{children:e.jsxs(x,{children:[e.jsx(a,{scope:"col",children:"#"}),e.jsx(a,{scope:"col",children:"Tên món"}),e.jsx(a,{scope:"col",children:"Giá"}),e.jsx(a,{scope:"col",className:"mb-2",children:"Số lượng"})]})}),e.jsx(F,{children:b.map((t,s)=>e.jsxs(x,{children:[e.jsx(a,{scope:"row",children:s+1}),e.jsx(h,{children:t.foodName}),e.jsxs(h,{children:[t.price,".000 VNĐ"]}),e.jsx(h,{children:t.quantity})]},t.id))})]}),e.jsx("div",{style:{marginVertical:10,height:5,borderRadius:10,backgroundColor:"#F3F4F7"}}),e.jsx(P,{style:{marginTop:10},color:"success",children:"Bạn đã đặt thành công!"}),e.jsxs(f,{className:"mb-4",style:{marginTop:10,padding:15,display:"flex",flexDirection:"row",justifyContent:"space-between"},children:[e.jsxs("div",{style:{display:"flex",flexDirection:"column"},children:[e.jsxs("span",{style:{fontSize:28,fontWeight:"bold",color:"#1B9E3E"},children:[S(C)," VNĐ"]}),e.jsx("span",{style:{},children:"Tổng tiền"})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column"},children:e.jsx(u,{onClick:()=>V(),type:"submit",color:"secondary",children:"HỦY ĐẶT"})})]})]}):e.jsxs(O,{children:[e.jsx("p",{className:"text-body-secondary small",children:"Chọn món và sau đó xác nhận."}),e.jsxs(q,{children:[e.jsx(v,{children:e.jsxs(x,{children:[e.jsx(a,{scope:"col",children:"#"}),e.jsx(a,{scope:"col",children:"Tên món"}),e.jsx(a,{scope:"col",children:"Giá"}),e.jsx(a,{scope:"col",className:"mb-2",children:"Số lượng"})]})}),e.jsx(F,{children:c.map((t,s)=>e.jsxs(x,{children:[e.jsx(a,{scope:"row",children:s+1}),e.jsx(h,{children:t.name}),e.jsxs(h,{children:[t.price,".000 VNĐ"]}),e.jsx(h,{className:"mb-2",children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx(u,{color:"secondary",onClick:()=>B(s),children:"-"}),e.jsx(W,{type:"number",value:t.quantity,onChange:n=>k(s,n),style:{maxWidth:150,minWidth:50,marginLeft:10,marginRight:10},min:0,max:10}),e.jsx(u,{color:"secondary",onClick:()=>E(s),children:"+"})]})})]},t.id))})]}),e.jsx("div",{style:{marginVertical:10,height:5,borderRadius:10,backgroundColor:"#F3F4F7"}}),e.jsxs(f,{className:"mb-4",style:{marginTop:10,padding:15,display:"flex",flexDirection:"row",justifyContent:"space-between"},children:[e.jsxs("div",{style:{display:"flex",flexDirection:"column"},children:[e.jsxs("span",{style:{fontSize:28,fontWeight:"bold",color:"#1B9E3E"},children:[S(C)," VNĐ"]}),e.jsx("span",{style:{},children:"Tổng tiền"})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column"},children:e.jsx(u,{onClick:()=>M(),type:"submit",color:"primary",children:"Xác nhận"})})]})]})]})})};export{re as default};
